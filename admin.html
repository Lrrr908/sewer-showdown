<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sewer Showdown — Dev Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
:root {
  --bg:       #0d0f14;
  --surface:  #111521;
  --surface2: #161c2c;
  --border:   #202430;
  --border-hl:#3a4a70;
  --text:     #e6e9f2;
  --muted:    #8892a8;
  --accent:   #6aa9ff;
  --green:    #4ade80;
  --red:      #ff6b6b;
  --yellow:   #fcd36a;
  --nes-yellow:#fcfc00;
  --nes-cyan: #3cbcfc;
  --nes-pink: #fc7460;
  --nes-navy: #24188c;
}
* { margin:0; padding:0; box-sizing:border-box; }
html, body { height:100%; background:var(--bg); color:var(--text); font-family: system-ui, -apple-system, sans-serif; font-size:13px; overflow:hidden; }

#app { display:flex; flex-direction:column; height:100%; }

/* ── Tab bar ── */
#tabBar {
  display:flex; gap:0; background:var(--surface); border-bottom:1px solid var(--border);
  flex-shrink:0; overflow-x:auto; user-select:none;
}
.tab-btn {
  padding:10px 18px; cursor:pointer; color:var(--muted); border:none; background:none;
  font-size:12px; font-family:inherit; white-space:nowrap; border-bottom:2px solid transparent;
  transition: color .15s, border-color .15s;
}
.tab-btn:hover { color:var(--text); background:var(--surface2); }
.tab-btn.active { color:var(--accent); border-bottom-color:var(--accent); }

/* ── Tab panels ── */
.tab-panel { display:none; flex:1; overflow:hidden; }
.tab-panel.active { display:flex; }

/* ── Shared UI ── */
.panel { background:var(--surface); border:1px solid var(--border); border-radius:6px; padding:10px; }
.panel-title { font-size:12px; font-weight:600; color:var(--accent); margin-bottom:8px; }
.btn {
  background:var(--surface2); border:1px solid var(--border); color:var(--text); padding:6px 12px;
  border-radius:4px; cursor:pointer; font-size:12px; font-family:inherit; white-space:nowrap;
}
.btn:hover { background:#232c42; border-color:var(--border-hl); }
.btn.primary { background:var(--accent); color:#000; border-color:var(--accent); }
.btn.primary:hover { background:#88bbff; }
.btn.danger { background:var(--red); color:#000; border-color:var(--red); }
.btn.success { background:var(--green); color:#000; border-color:var(--green); }
.btn.small { padding:4px 8px; font-size:11px; }
.btn-row { display:flex; gap:6px; flex-wrap:wrap; }
label { font-size:11px; color:var(--muted); font-weight:600; }
input, select, textarea {
  background:var(--bg); border:1px solid var(--border); color:var(--text);
  padding:5px 8px; border-radius:4px; font-size:12px; font-family:inherit;
}
input:focus, select:focus, textarea:focus { outline:none; border-color:var(--accent); }
hr { border:0; border-top:1px solid var(--border); margin:8px 0; }
.row { display:flex; gap:8px; align-items:center; }
.col { display:flex; flex-direction:column; gap:6px; }
.flex-1 { flex:1; min-width:0; }
.scroll-y { overflow-y:auto; }
canvas { image-rendering:pixelated; image-rendering:crisp-edges; }
.mono { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
.badge { display:inline-block; padding:2px 6px; border-radius:3px; font-size:10px; font-weight:600; }
.badge-blue { background:var(--accent); color:#000; }
.badge-green { background:var(--green); color:#000; }
.status-msg { font-size:11px; color:var(--green); min-height:16px; }

/* palette swatch */
.pal-swatch {
  display:inline-block; width:22px; height:22px; border:2px solid var(--border);
  cursor:pointer; vertical-align:middle; border-radius:2px;
}
.pal-swatch.active { border-color:#fff; box-shadow:0 0 6px #fff; }

/* Scrollbars */
::-webkit-scrollbar { width:8px; height:8px; }
::-webkit-scrollbar-track { background:var(--bg); }
::-webkit-scrollbar-thumb { background:var(--border-hl); border-radius:4px; }
::-webkit-scrollbar-thumb:hover { background:var(--muted); }

/* ── Import/Export hub panel ── */
#tab-data.active { overflow-y:auto; }
</style>
</head>
<body>
<div id="app">
  <div id="tabBar">
    <button class="tab-btn active" data-tab="sprites">Sprite Editor</button>
    <button class="tab-btn" data-tab="levels">Level Builder</button>
    <button class="tab-btn" data-tab="overview">Overview Map</button>
    <button class="tab-btn" data-tab="world">World Map</button>
    <button class="tab-btn" data-tab="artists">Artists &amp; Buildings</button>
    <button class="tab-btn" data-tab="ripper">Sprite Ripper</button>
    <button class="tab-btn" data-tab="data">Import / Export</button>
  </div>

  <div id="tab-sprites"  class="tab-panel active"></div>
  <div id="tab-levels"   class="tab-panel"></div>
  <div id="tab-overview" class="tab-panel"></div>
  <div id="tab-world"    class="tab-panel"></div>
  <div id="tab-artists"  class="tab-panel"></div>
  <div id="tab-ripper"   class="tab-panel"></div>
  <div id="tab-data"     class="tab-panel"></div>
</div>

<input type="file" id="globalFileInput" accept=".json,.csv,.png,.jpg" style="display:none">

<!-- Hidden canvas required by game.js initialization -->
<canvas id="gameCanvas" style="display:none" width="256" height="240"></canvas>

<!-- Prevent game.js from auto-starting the game loop on admin page -->
<script>
window.__ADMIN_MODE = true;
</script>
<!-- Shared foundation (order matters) -->
<script src="js/shared/errors.js"></script>
<script src="js/shared/path.js"></script>
<script src="js/shared/versioning.js"></script>
<script src="js/shared/palette.js"></script>
<script src="js/shared/rng.js"></script>
<script src="js/shared/pattern_core.js"></script>
<script src="js/shared/level_schema.js"></script>
<!-- Validators -->
<script src="js/shared/validators/validate_patterns.js"></script>
<script src="js/shared/validators/validate_artists.js"></script>
<script src="js/shared/validators/validate_buildings.js"></script>
<script src="js/shared/validators/validate_level.js"></script>
<script src="js/shared/validators/validate_region.js"></script>
<script src="js/shared/validators/validate_world.js"></script>
<!-- Admin data layer -->
<script src="js/admin/data_bus.js"></script>
<script src="js/admin/patterns_store.js"></script>
<!-- Admin bridge (dev-only) -->
<script src="js/admin-bridge.js?v=41"></script>
<script>
// One-time fix: remove corrupted turtleDown1 from cached patterns
(function(){
    try {
        var raw = localStorage.getItem('adminSync_patterns');
        if (!raw) return;
        var pats = JSON.parse(raw);
        if (pats.turtleDown1) {
            delete pats.turtleDown1;
            localStorage.setItem('adminSync_patterns', JSON.stringify(pats));
            console.log('Cleared corrupted turtleDown1 from pattern cache');
        }
    } catch(e) {}
})();
</script>
<script src="js/game.js?v=55"></script>
<script>
// game.js checks window.__ADMIN_MODE and skips init() when set.
// The NES module (PAL, PATTERNS, drawTile, etc.) is what we actually need.
</script>
<script src="js/admin.js?v=40"></script>
<script src="js/admin-sprites.js?v=42"></script>
<script src="js/admin-levels.js"></script>
<script src="js/admin-overview.js"></script>
<script src="js/admin-world.js"></script>
<script src="js/admin-artists.js"></script>
<script src="js/admin-ripper.js"></script>
</body>
</html>
